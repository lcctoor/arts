# æè¿°

ä¸€ä¸ªä¼˜é›…çš„ MongoDB ODM ã€‚

[æºç ](https://github.com/lcctoor/skk/tree/main/skk/mongo)

# æ•™ç¨‹

æœ¬æ–‡å°†ä»¥ç®€æ´çš„æ–¹å¼å‘ä½ ä»‹ç»æ ¸å¿ƒçŸ¥è¯†ï¼Œè€Œä¸ä¼šè®©ä½ è¢«ç¹ççš„æœ¯è¯­æ‰€æ·¹æ²¡ã€‚

## å®‰è£…

```bash
pip install skk
```

## å¯¼å…¥

```python
from pymongo import MongoClient as mongo_client
from motor.motor_asyncio import AsyncIOMotorClient as motor_client
from skk.mongo import ODM, mc, mf, mo
```

## åˆ›å»ºODM

```python
class My_ODM(ODM):

    def mkconn(self):  # å®šä¹‰åŒæ­¥è¿æ¥å™¨
        return mongo_client(host='localhost', port=27017)
  
    async def amkconn(self):  # å®šä¹‰å¼‚æ­¥è¿æ¥å™¨
        return motor_client(host='localhost', port=27017)

odm = My_ODM()          # è´¦æˆ·ODM
db = odm['æ³‰å·å¸‚']      # åº“ODM
sheet = db['å¸Œæœ›å°å­¦']  # è¡¨ODM
```

## åŸºç¡€åŠŸèƒ½ â€”â€” å¢ã€æŸ¥ã€æ”¹ã€åˆ 

ã€å¢ã€æŸ¥ã€æ”¹ã€åˆ ã€‘çš„åŒæ­¥æ–¹æ³•åç§°åˆ†åˆ«ä¸ºï¼šinsertã€findã€updateã€delete ã€‚

å¯¹åº”çš„å¼‚æ­¥æ–¹æ³•åç§°ä¸ºå„åŒæ­¥æ–¹æ³•åå‰åŠ  `a` ï¼Œå³ï¼šainsertã€afindã€aupdateã€adelete ã€‚

### ç¤ºä¾‹

```python
row1 = {'å§“å':'å°ä¸€', 'å¹´é¾„':11, 'å¹¸è¿æ•°å­—':[1, 2, 3], 'æˆç»©':{'è¯­æ–‡':81, 'æ•°å­¦':82}}
row2 = {'å§“å':'å°äºŒ', 'å¹´é¾„':12, 'å¹¸è¿æ•°å­—':[2, 3, 4], 'æˆç»©':{'è¯­æ–‡':82, 'æ•°å­¦':83}}
row3 = {'å§“å':'å°ä¸‰', 'å¹´é¾„':13, 'å¹¸è¿æ•°å­—':[3, 4, 5], 'æˆç»©':{'è¯­æ–‡':83, 'æ•°å­¦':84}}
row4 = {'å§“å':'å°å››', 'å¹´é¾„':14, 'å¹¸è¿æ•°å­—':[4, 5, 6], 'æˆç»©':{'è¯­æ–‡':84, 'æ•°å­¦':85}}
row5 = {'å§“å':'å°äº”', 'å¹´é¾„':15, 'å¹¸è¿æ•°å­—':[5, 6, 7], 'æˆç»©':{'è¯­æ–‡':85, 'æ•°å­¦':86}}
row6 = {'å§“å':'å°å…­', 'å¹´é¾„':16, 'å¹¸è¿æ•°å­—':[6, 7, 8], 'æˆç»©':{'è¯­æ–‡':86, 'æ•°å­¦':87}}
```

|            | åŒæ­¥æ–¹å¼                      | å¼‚æ­¥æ–¹å¼                                                 |
| :---------: | ----------------------------- | -------------------------------------------------------- |
| å¢ï¼ˆ1Â æ¡ï¼‰ | sheet.insert( row1 )          | await sheet.ainsert( row2 )          |
| å¢ï¼ˆæ‰¹é‡ï¼‰ | sheet.insert( row3, row4 )    | await sheet.ainsert( row5, row6 )    |
|     æŸ¥     | sheet.find( )                 | await sheet.afind( )                 |
|     æ”¹     | sheet.update( {'å¹´é¾„': 100} ) | await sheet.aupdate( {'å¹´é¾„': 200} ) |
|     åˆ      | sheet.delete( )               | await sheet.adelete( )               |

### æ–°å¢æ—¶ï¼ŒæŸ¥çœ‹åˆ†é…åˆ°çš„ä¸»é”®ï¼š

```python
row1 = {'å§“å':'å°ä¸€', 'å¹´é¾„':11, 'å¹¸è¿æ•°å­—':[1, 2, 3], 'æˆç»©':{'è¯­æ–‡':81, 'æ•°å­¦':82}}
row2 = {'å§“å':'å°äºŒ', 'å¹´é¾„':12, 'å¹¸è¿æ•°å­—':[2, 3, 4], 'æˆç»©':{'è¯­æ–‡':82, 'æ•°å­¦':83}}
row3 = {'å§“å':'å°ä¸‰', 'å¹´é¾„':13, 'å¹¸è¿æ•°å­—':[3, 4, 5], 'æˆç»©':{'è¯­æ–‡':83, 'æ•°å­¦':84}}

r1 = sheet.insert( row1 )
r2 = sheet.insert( row2, row3 )
```

æ–¹æ³•1ï¼šä½¿ç”¨ insert æ·»åŠ æ•°æ®æˆåŠŸåï¼Œrow1~row3 å·²å„è‡ªå¤šäº†ä¸€ä¸ªå«â€˜_idâ€™çš„é”®ï¼Œè¯¥é”®çš„å€¼å³åˆ†é…åˆ°çš„ä¸»é”®ã€‚

æ–¹æ³•2ï¼š

```python
r1.inserted_id
r2.inserted_ids
```

## æ³¨ï¼šä¸‹æ–‡ä¸­æ‰€æœ‰ç¤ºä¾‹éƒ½åŒæ—¶æ”¯æŒåŒæ­¥æ–¹å¼å’Œå¼‚æ­¥æ–¹å¼ï¼Œå°†åŒæ­¥ç¤ºä¾‹ä¸­çš„ insertã€deleteã€updateã€find æ›¿æ¢ä¸º ainsertã€adeleteã€aupdateã€afind å³ä¸ºå¼‚æ­¥æ–¹å¼ï¼Œå½“ç„¶ï¼Œé¡»åŠ ä¸Š await å‰ç¼€ã€‚

## æ¡ä»¶ç­›é€‰

### ç¤ºä¾‹ä¸€ï¼šç†è§£æ¡ä»¶ç­›é€‰çš„åŸºæœ¬èŒƒå¼

ç­›é€‰ã€å¹´é¾„>13ï¼Œä¸”è§†åŠ›â‰§4.6ï¼Œä¸”æ€§åˆ«ä¸ºå¥³ã€‘çš„æ•°æ®ï¼Œå¹¶è¿›è¡ŒæŸ¥æ”¹åˆ ï¼š

**æŸ¥è¯¢**ï¼š`sheet[mc.å¹´é¾„ > 13][mc.è§†åŠ› >= 4.6][mc.æ€§åˆ« == 'å¥³'].find( )`

**ä¿®æ”¹**ï¼š`sheet[mc.å¹´é¾„ > 13][mc.è§†åŠ› >= 4.6][mc.æ€§åˆ« == 'å¥³'].update( {'å¹´çº§':'åˆä¸€', 'çˆ±å¥½':'ç”»ç”»,è·³ç»³'} )`

**åˆ é™¤**ï¼š`sheet[mc.å¹´é¾„ > 13][mc.è§†åŠ› >= 4.6][mc.æ€§åˆ« == 'å¥³'].delete( )`

### ç­›é€‰æ“ä½œæ¸…å•

| **ä»£ç **                                                                 | è§£é‡Š                                            |
| ------------------------------------------------------------------------------ | ----------------------------------------------- |
| mc.å¹´é¾„ > 10                                                                   | å¤§äº                                            |
| mc.å¹´é¾„ >= 10                                                                  | å¤§äºæˆ–ç­‰äº                                      |
| mc.å¹´é¾„ < 10                                                                   | å°äº                                            |
| mc.å¹´é¾„ <= 10                                                                  | å°äºæˆ–ç­‰äº                                      |
| mc.å¹´é¾„ == 10                                                                  | ç­‰äº                                            |
| mc.å¹´é¾„ != 10                                                                  | ä¸ç­‰äº                                          |
| mc.å¹´çº§ == mf.isin( 'åˆä¸‰', 'é«˜äºŒ' )                                           | è‹¥å­—æ®µå€¼æ˜¯ä¼ å…¥å€¼çš„æˆå‘˜ï¼Œåˆ™ç¬¦åˆ                  |
| mc.å¹´é¾„ == mf.notin( 10, 30, 45 )                                              | è‹¥å­—æ®µå€¼ä¸æ˜¯ä¼ å…¥å€¼çš„æˆå‘˜ï¼Œåˆ™ç¬¦åˆ                |
| mc.çˆ±å¥½ == mf.contain_all( 'ç”»ç”»', 'è¶³çƒ' )                                    | è‹¥ï¼ˆåˆ—è¡¨ï¼‰å­—æ®µå€¼åŒ…å«ä¼ å…¥å€¼çš„æ‰€æœ‰å…ƒç´ ï¼Œåˆ™ç¬¦åˆ    |
| mc.çˆ±å¥½ == mf.contain_any( 'ç”»ç”»', 'è¶³çƒ' )                                    | è‹¥ï¼ˆåˆ—è¡¨ï¼‰å­—æ®µå€¼åŒ…å«ä¼ å…¥å€¼çš„è‡³å°‘1ä¸ªå…ƒç´ ï¼Œåˆ™ç¬¦åˆ |
| mc.çˆ±å¥½ == mf.contain_none( 'ç”»ç”»', 'è¶³çƒ' )                                   | è‹¥ï¼ˆåˆ—è¡¨ï¼‰å­—æ®µå€¼ä¸åŒ…å«ä¼ å…¥å€¼çš„ä»»ä½•å…ƒç´ ï¼Œåˆ™ç¬¦åˆ  |
| mc.å§“å == mf.re( 'å°' )                                                       | æ­£åˆ™åŒ¹é…                                        |
| \[mc.å¹´é¾„ > 3\][mc.å¹´é¾„ < 100]                                                 | äº¤é›†ï¼ˆæ–¹å¼ä¸€ï¼‰                                  |
| [ (mc.å¹´é¾„ > 3) & (mc.å¹´é¾„ < 100) ]                                            | äº¤é›†ï¼ˆæ–¹å¼äºŒï¼‰                                  |
| [(mc.å¹´é¾„<30)&#124; (mc.å¹´é¾„>30) &#124; (mc.å¹´é¾„==30)Â &#124; (mc.å¹´é¾„==None)] | å¹¶é›†                                            |
| [ (mc.å¹´é¾„ > 3) - (mc.å¹´é¾„ > 100) ]                                            | å·®é›†                                            |
| [ ~(mc.å¹´é¾„ > 100) ]                                                           | è¡¥é›†                                            |

æ³¨ï¼š

1ã€isinã€notin ç”¨äºåˆ¤æ–­ï¼ˆæ™®é€šï¼‰å­—æ®µçš„å€¼æ˜¯å¦ä¼ å…¥å€¼çš„æˆå‘˜ï¼Œé’ˆå¯¹æ™®é€šå­—æ®µã€‚

2ã€contain_anyã€contain_none ç”¨äºåˆ¤æ–­ä¼ å…¥å€¼æ˜¯å¦ï¼ˆåˆ—è¡¨ï¼‰å­—æ®µçš„å€¼çš„æˆå‘˜ï¼Œé’ˆå¯¹åˆ—è¡¨å­—æ®µã€‚

3ã€isinã€notinã€contain_allã€contain_anyã€contain_none çš„ä¼ å…¥å€¼éƒ½ä¸å¿…æ˜¯åŒç±»å‹çš„æ•°æ®ï¼Œä»¥ isin ä¸ºä¾‹ï¼šå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼šmc.tag == mf.isin( 3, 3.5, 'å­¦ç”Ÿ', None )ï¼Œä¼ å…¥å€¼å«æœ‰ intã€floatã€strã€NoneType ç­‰å¤šç§ç±»å‹ã€‚

4ã€æˆå‘˜è¿ç®—ç¬¦æœªä¼ å…¥ä»»ä½•å€¼æ—¶çš„å¤„ç†æ–¹å¼ï¼š

| **ä»£ç **                | **å¤„ç†æ–¹å¼** |
| ----------------------------- | ------------------ |
| mc.å¹´çº§ == mf.isin( )         | æ‰€æœ‰æ•°æ®éƒ½ ä¸ç¬¦åˆ  |
| mc.å¹´çº§ == mf.notin( )        | æ‰€æœ‰æ•°æ®éƒ½ ç¬¦åˆ    |
| mc.çˆ±å¥½ == mf.contain_all( )  | æ‰€æœ‰æ•°æ®éƒ½ ç¬¦åˆ    |
| mc.çˆ±å¥½ == mf.contain_any( )  | æ‰€æœ‰æ•°æ®éƒ½ ä¸ç¬¦åˆ  |
| mc.çˆ±å¥½ == mf.contain_none( ) | æ‰€æœ‰æ•°æ®éƒ½ ç¬¦åˆ    |

5ã€å››ç§é›†åˆè¿ç®—å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œä¸”å¯ä»¥æ— é™åµŒå¥—ã€‚

### ç¤ºä¾‹äºŒï¼šç†è§£å¹¶é›†ã€äº¤é›†ã€è¡¥é›†çš„ä½¿ç”¨

ç­›é€‰ã€å¹´é¾„>13æˆ–è§†åŠ›â‰§4.6ã€ä¸”å§“åå«æœ‰â€˜å°â€™ã€ä¸”å¹´é¾„ä¸é«˜äº15ã€‘çš„æ•°æ®ï¼š

**æŸ¥è¯¢**ï¼š`sheet[(mc.å¹´é¾„>13) | (mc.è§†åŠ›>=4.6)][mc.å§“å == mf.re('å°')][~(mc.å¹´é¾„>15)].find( )`

**ä¿®æ”¹**ï¼š`sheet[(mc.å¹´é¾„>13) | (mc.è§†åŠ›>=4.6)][mc.å§“å == mf.re('å°')][~(mc.å¹´é¾„>15)].update( {'å¹´çº§':'åˆä¸‰'} )`

**åˆ é™¤**ï¼š`sheet[(mc.å¹´é¾„>13) | (mc.è§†åŠ›>=4.6)][mc.å§“å == mf.re('å°')][~(mc.å¹´é¾„>15)].delete( )`

### æ ¹æ®å­å…ƒç´ è¿‡æ»¤

å¯ä½¿ç”¨  mc.xxx.xxx.xxx...  çš„å½¢å¼æ¥è¡¨ç¤ºå­å­™å…ƒç´ ã€‚

æŸ¥è¯¢ã€è¯­æ–‡æˆç»©>80ã€‘çš„æ•°æ®ï¼š

```python
sheet[mc.æˆç»©.è¯­æ–‡ > 80].find()
```

## ç‰¹æ®Šå­—æ®µåçš„è¡¨ç¤ºæ–¹æ³•

MongoDB æ”¯æŒå„ç§ç‰¹æ®Šçš„å­—æ®µåï¼Œå¦‚ï¼šæ•°å­—ã€ç¬¦å·ã€emoji è¡¨æƒ…ï¼Œè¿™äº›å­—ç¬¦åœ¨ Python ä¸­ä¸æ˜¯åˆæ³•å˜é‡åï¼Œå› æ­¤ä½¿ç”¨  mc.1ã€mc.+  ç­‰æ ¼å¼ä¼šæŠ¥é”™ï¼Œå¯ç”¨  mc['1']ã€mc['+']ã€mc['ğŸ‘ˆ']  è¿™ç§æ ¼å¼ä»£æ›¿ã€‚

## åˆ‡ç‰‡

1ã€åˆ‡ç‰‡æ ¼å¼ä¸º  [start: stop: step]  ï¼Œstart è¡¨ç¤ºä»å“ªæ¡å¼€å§‹ï¼Œstop è¡¨ç¤ºåˆ°å“ªæ¡åœæ­¢ï¼Œstep è¡¨ç¤ºæ­¥é•¿ã€‚

2ã€start å’Œ stop

* å½“ä¸ºæ­£å€¼æ—¶ï¼Œè¡¨ç¤ºæ­£åºç¬¬ x æ¡ï¼Œä¾‹å¦‚ï¼š1 è¡¨ç¤ºç¬¬ 1 æ¡ã€2 è¡¨ç¤ºç¬¬ 2 æ¡ã€‚
* å½“ä¸ºè´Ÿå€¼æ—¶ï¼Œè¡¨ç¤ºå€’æ•°ç¬¬ x æ¡ï¼Œä¾‹å¦‚ï¼š-1 è¡¨ç¤ºå€’æ•°ç¬¬ 1 æ¡ã€-2 è¡¨ç¤ºå€’æ•°ç¬¬ 2 æ¡ã€‚
* ä¸å¯ä¸º 0 ã€‚

3ã€step

* é¡»ä¸ºæ­£æ•´æ•°ã€‚
* å½“ step >= 2  æ—¶è¡¨ç¤ºé—´éš”å¼åˆ‡ç‰‡ã€‚
* å½“ step = 1 æ—¶å¯çœç•¥ `: step` ï¼Œå³ï¼š[start: stop] ç­‰ä»·äº [start: stop: 1] ã€‚

### ç¤ºä¾‹

```python
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][:].find()                      # æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„å…¨éƒ¨æ•°æ®
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][:].delete()                    # åˆ é™¤ç¬¦åˆæ¡ä»¶çš„å…¨éƒ¨æ•°æ®
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][:].update({'å¹´çº§':'åˆä¸€'})      # ä¿®æ”¹ç¬¦åˆæ¡ä»¶çš„å…¨éƒ¨æ•°æ®

sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][1].find()                      # æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ç¬¬1æ¡
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][1].delete()                    # åˆ é™¤ç¬¦åˆæ¡ä»¶çš„ç¬¬1æ¡
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][1].update({'å¹´çº§':'åˆä¸€'})      # ä¿®æ”¹ç¬¦åˆæ¡ä»¶çš„ç¬¬1æ¡

sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][3:7].find()                    # æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ç¬¬3~7æ¡
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][3:7].delete()                  # åˆ é™¤ç¬¦åˆæ¡ä»¶çš„ç¬¬3~7æ¡
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][3:7].update({'å¹´çº§':'åˆä¸€'})    # ä¿®æ”¹ç¬¦åˆæ¡ä»¶çš„ç¬¬3~7æ¡

sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][3:7:2].find()                  # æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ç¬¬3ã€5ã€7æ¡
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][3:7:2].delete()                # åˆ é™¤ç¬¦åˆæ¡ä»¶çš„ç¬¬3ã€5ã€7æ¡
sheet[è¿‡æ»¤å™¨]...[è¿‡æ»¤å™¨][3:7:2].update({'å¹´çº§':'åˆä¸€'})  # ä¿®æ”¹ç¬¦åˆæ¡ä»¶çš„ç¬¬3ã€5ã€7æ¡
```

å€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š  [3: 8: 2]  æ“ä½œç¬¬  3ã€5ã€7  æ¡ï¼Œè€Œ  [8: 3: 2]  æ“ä½œç¬¬  8ã€6ã€4  æ¡ã€‚

æ›´å¤šç¤ºä¾‹ï¼š

```python
[:]           # æ‰€æœ‰æ•°æ®
[1:-1]        # æ‰€æœ‰æ•°æ®
[-1:1]        # æ‰€æœ‰æ•°æ®ï¼ˆé€†åºï¼‰
[1:]          # æ‰€æœ‰æ•°æ®
[:1000]       # ç¬¬1æ¡ ~ ç¬¬1000æ¡
[:-1000]      # ç¬¬1æ¡ ~ å€’æ•°ç¬¬1000æ¡
[100:200]     # ç¬¬100æ¡ ~ ç¬¬200æ¡
[200:100]     # ç¬¬200æ¡ ~ ç¬¬100æ¡
[-300:-2]     # å€’æ•°ç¬¬300æ¡ ~ å€’æ•°ç¬¬2æ¡
[50:-2]       # ç¬¬50æ¡ ~ å€’æ•°ç¬¬2æ¡
[250:]        # ç¬¬250æ¡ ~ æœ€å1æ¡
[-250:]       # å€’æ•°ç¬¬250æ¡ ~ æœ€å1æ¡
[1]           # ç¬¬1æ¡
[-1]          # æœ€å1æ¡
[::3]         # ä»¥3ä¸ºé—´è·, é—´éš”æ“ä½œæ‰€æœ‰æ•°æ®
[100:200:4]   # ä»¥4ä¸ºé—´è·, é—´éš”æ“ä½œç¬¬100æ¡ ~ ç¬¬200æ¡
```

## å­—æ®µæç¤º

å˜é‡ mc æ— å­—æ®µæç¤ºåŠŸèƒ½ï¼Œè¾“å…¥â€˜mc.â€™åï¼Œç¼–è¾‘å™¨ä¸ä¼šæç¤ºå¯é€‰å­—æ®µã€‚

ä¸ºäº†è·å¾—å­—æ®µæç¤ºåŠŸèƒ½ï¼Œå¯è‡ªå»ºä¸€ä¸ªâ€˜mc2â€™ï¼š

```python
class mc2(mc):
    å§“å = å¹´é¾„ = å¹¸è¿æ•°å­— = None
    class æˆç»©:
        è¯­æ–‡ = æ•°å­¦ = None

sheet[mc.å§“å == 'å°ç‹'][mc2.å¹´é¾„ > 10].find()
sheet[mc.å§“å == 'å°ç‹'][mc2.æˆç»©.è¯­æ–‡ > 80].find()
```

æ³¨ï¼š

1ã€mc2 ä¸ mc ç”¨æ³•å®Œå…¨ä¸€è‡´ï¼Œå¯æ··ç”¨ã€‚

2ã€mc2 è®¾ç½®å­—æ®µæç¤ºåï¼Œä»…å…·å¤‡æç¤ºæ•ˆæœï¼Œè€Œä¸äº§ç”Ÿä»»ä½•å®é™…çº¦æŸã€‚

## æ’åº

å¯¹æ‰€æœ‰å¹´é¾„>12çš„æ•°æ®ï¼Œä¼˜å…ˆæŒ‰å¹´é¾„é™åºï¼Œå…¶æ¬¡æŒ‰å§“åå‡åºï¼Œæ’åºåè¿”å›ç¬¬ 2\~4 æ¡æ•°æ®ï¼š

```python
sheet[mc.å¹´çº§=='é«˜ä¸€'].order(å¹´é¾„=False, å§“å=True)[2:4].find()
```

æœ‰è¶£çš„ï¼Œä»¥ä¸‹ä¸¤è¡Œä»£ç çš„è¿”å›ç»“æœç›¸åŒï¼š

```python
sheet[mc.å¹´çº§=='é«˜ä¸€'].order(å¹´é¾„=True)[1:-1].find()

sheet[mc.å¹´çº§=='é«˜ä¸€'].order(å¹´é¾„=False)[-1:1].find()
```

è§£é‡Šï¼šorder(å¹´é¾„=False) è¡¨ç¤ºæŒ‰å¹´é¾„é™åºï¼Œ[-1:1]è¡¨ç¤ºé€†åºåˆ‡ç‰‡ï¼Œäº§ç”Ÿäº†ç±»ä¼¼â€˜è´Ÿè´Ÿå¾—æ­£â€™çš„æ•ˆæœã€‚

æ³¨ï¼š

1ã€ç­›é€‰å™¨ã€åˆ‡ç‰‡å™¨ã€æ’åºå™¨ã€é™å®šå­—æ®µå™¨çš„ä½ç½®å¯ä»»æ„ï¼Œä½ç½®ä¸å½±å“å…¶æ•ˆæœã€‚å½“ç„¶ï¼Œå®ƒä»¬éƒ½åº”è¯¥åœ¨ sheet ä¹‹åï¼Œä¸”åœ¨ find/update/delete ä¹‹å‰ã€‚

2ã€å¯åå¤æ’åºï¼Œfind/update/delete æ—¶æ˜¯æ ¹æ®æœ€å1æ¬¡æŒ‡å®šçš„é¡ºåºæå–æ•°æ®ã€‚ä»¥ä¸‹ä»£ç æœ€ç»ˆæ˜¯æŒ‰å¹´é¾„é™åºåæå–æ•°æ®ï¼š

```python
sheet.order(å¹´é¾„=True, å§“å=False).order(å¹´é¾„=False).find()
```

3ã€è‹¥æƒ³å–æ¶ˆæ’åºï¼Œåˆ™å†æ¬¡è°ƒç”¨orderæ–¹æ³•ï¼Œä½†ä¸ä¼ å…¥ä»»ä½•å€¼ã€‚

```python
sheet.order(å¹´é¾„=True, å§“å=False).order().find()
```

## é™å®šå­—æ®µ

åªè¿”å›å§“åã€å¹´é¾„è¿™2ä¸ªå­—æ®µï¼š

```python
sheet[mc.å¹´çº§=='é«˜ä¸€']['å§“å','å¹´é¾„'].find()
```

æ³¨ï¼š

1ã€é™å®šå­—æ®µåªå¯¹ find æœ‰ä½œç”¨ï¼Œå¯¹ update/delete æ— ä½œç”¨ä½†ä¸ä¼šæŠ¥é”™ã€‚

2ã€ç­›é€‰å™¨ã€åˆ‡ç‰‡å™¨ã€æ’åºå™¨ã€é™å®šå­—æ®µå™¨çš„ä½ç½®å¯ä»»æ„ï¼Œä½ç½®ä¸å½±å“å…¶æ•ˆæœã€‚å½“ç„¶ï¼Œå®ƒä»¬éƒ½åº”è¯¥åœ¨ sheet ä¹‹åï¼Œä¸”åœ¨ find/update/delete ä¹‹å‰ã€‚

3ã€å¯åå¤é™å®šå­—æ®µï¼ŒæŸ¥è¯¢æ—¶æ˜¯æ ¹æ®æœ€åä¸€æ¬¡æŒ‡å®šçš„å­—æ®µæå–æ•°æ®ã€‚ä»¥ä¸‹ä»£ç è¿”å›ç»“æœä¸­åªæœ‰â€˜å¹´é¾„â€™å­—æ®µï¼š

```python
sheet[mc.å¹´çº§=='é«˜ä¸€']['å§“å']['å¹´é¾„'].find()
```

4ã€è‹¥æƒ³æ¢å¤æå–å…¨éƒ¨å­—æ®µï¼Œåˆ™é™å®šå­—æ®µä¸º `None` ï¼Œ`None` å³ä»£è¡¨â€œå…¨éƒ¨å­—æ®µâ€ã€‚

```python
sheet[mc.å¹´çº§=='é«˜ä¸€']['å§“å'][None].find()
```

## ç»Ÿè®¡ ä¸ åˆ åº“åˆ è¡¨

|                        | åŒæ­¥æ–¹å¼                    | å¼‚æ­¥æ–¹å¼                                               |
| ---------------------- | --------------------------- | ------------------------------------------------------ |
| ç»Ÿè®¡åº“çš„æ•°é‡           | odm.len( )                  | await odm.alen( )                  |
| ç»Ÿè®¡è¡¨çš„æ•°é‡           | db.len( )                   | await db.alen( )                   |
| ç»Ÿè®¡è¡Œçš„æ•°é‡           | sheet.len( )                | await sheet.alen( )                |
| ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„è¡Œçš„æ•°é‡ | sheet[ mc.age > 8Â ].len( ) | await sheet[ mc.age > 8Â ].alen( ) |
| è·å–åº“åæ¸…å•           | odm.get_db_names( )         | await odm.aget_db_names( )         |
| è·å–è¡¨åæ¸…å•           | db.get_sheet_names( )       | await db.aget_sheet_names( )       |
| åˆ é™¤æŸä¸ªåº“             | db.delete_db( )             | awaitÂ db.adelete_db( )            |
| åˆ é™¤æŸå¼ è¡¨             | sheet.delete_sheet( )       | awaitÂ sheet.adelete_sheet( )      |

## è¿­ä»£æ‰€æœ‰ åº“ODM å’Œ è¡¨ODM

```python
# åŒæ­¥æ–¹å¼è¿­ä»£
for db in odm:
    for sheet in db:
        print(sheet.sheet_name)

# å¼‚æ­¥æ–¹å¼è¿­ä»£
async for db in odm:
    async for sheet in db:
        print(sheet.sheet_name)
```

## ç‰¹æ®Šæ“ä½œ

### ç¤ºä¾‹ï¼šè‡ªå¢

ç”±äºæ–°å¹´åˆ°äº†ï¼Œä»¤æ‰€æœ‰å­¦ç”Ÿçš„å¹´é¾„å¢åŠ  1 å²ï¼š

```python
sheet.update( {'å¹´é¾„': mo.inc( 1 )} )
```

### ç‰¹æ®Šæ“ä½œæ¸…å•ï¼š

| **è¯­æ³•**        | **å«ä¹‰**                                     |
| --------------------- | -------------------------------------------------- |
| mo.inc( 1.5 )         | è‡ªå¢ 1.5                                           |
| mo.inc( -1.5 )        | è‡ªå‡ 1.5                                           |
| mo.add( 1, 2, 3 )     | å‘åˆ—è¡¨å­—æ®µæ·»åŠ å…ƒç´ ï¼Œä»…å½“è¢«æ·»åŠ çš„å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ  |
| mo.push( 1, 2, 3 )    | å‘åˆ—è¡¨å­—æ®µæ·»åŠ å…ƒç´ ï¼Œæ— è®ºè¢«æ·»åŠ çš„å…ƒç´ æ˜¯å¦å­˜åœ¨éƒ½æ·»åŠ  |
| mo.pull( 15 )         | ä»åˆ—è¡¨å­—æ®µåˆ é™¤ 1 ä¸ªç­‰äº 15 çš„å€¼                    |
| mo.popfirst           | ä»åˆ—è¡¨å­—æ®µåˆ é™¤ç¬¬ 1 ä¸ªå…ƒç´                           |
| mo.poplast            | ä»åˆ—è¡¨å­—æ®µåˆ é™¤æœ€å 1 ä¸ªå…ƒç´                         |
| mo.rename( 'æ–°åç§°' ) | é‡å‘½åå­—æ®µ                                         |
| mo.unset              | åˆ é™¤å­—æ®µ                                           |
| mo.delete             | åˆ é™¤å­—æ®µï¼ˆä¸ mo.unset ç­‰ä»·ï¼‰                       |

ç¤ºä¾‹ï¼š

```python
sheet[mc.å§“å=='å°å…­'].update({
    'å§“å': 'xiaoliu',          # ä¿®æ”¹ä¸ºâ€˜xiaoliuâ€™
    'å¹´é¾„': mo.inc(6),          # è‡ªå¢6
    'å¹¸è¿æ•°å­—': mo.push(666),   # æ·»åŠ 666
    'è§†åŠ›': mo.rename('çœ¼åŠ›'),  # å­—æ®µåæ”¹ä¸ºâ€˜çœ¼åŠ›â€™
    'ç±è´¯': mo.delete,          # åˆ é™¤æ­¤å­—æ®µ
    'æˆç»©.è¯­æ–‡': 60,            # æ”¹ä¸º60åˆ†
    'æˆç»©.æ•°å­¦': mo.inc(-6)     # å‡6åˆ†
})
```
